# 开发环境 Dockerfile，支持热重载
FROM --platform=$TARGETPLATFORM rust:1.75-bookworm

# 安装开发依赖
RUN apt-get update && apt-get install -y \
    pkg-config \
    libssl-dev \
    libpq-dev \
    curl \
    git \
    vim \
    && rm -rf /var/lib/apt/lists/*

# 安装开发工具
RUN cargo install cargo-watch cargo-edit cargo-expand

# 设置工作目录
WORKDIR /app

# 创建非 root 用户
RUN useradd -m -u 1001 -s /bin/bash jive && \
    chown -R jive:jive /app

# 切换到非 root 用户
USER jive

# 环境变量
ENV RUST_LOG=debug \
    RUST_BACKTRACE=1 \
    API_PORT=8012 \
    HOST=0.0.0.0

# 暴露端口
EXPOSE 8012 9229

# 默认命令（会被 docker-compose.dev.yml 覆盖）
CMD ["cargo", "run", "--bin", "jive-api"]